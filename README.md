# AI-ForestWatch: Semantic Segmentation based End-to-End Framework for Forest Change Detection Using Multi-spectral Remote Sensing Imagery

This repository contains the dataset and code used to develop the AI-ForestWatch framework for forest change detection. 

We perform pixelwise segmentation with U-Net to detect forest cover change as part of the [Billion Trees Tsunami Project](https://en.wikipedia.org/wiki/Billion_Tree_Tsunami).

## Description

The aim of this project is to use Landsat-8 imagery to perform forest cover change detection in the Billion Tree Tsunami Afforestation Regions in Pakistan. We do binary land cover segmentation of an image into forest/non-forest classes for our Areas of Interest (AOI), then repeat the same for a whole 7-year temporal series of images from 2014 to 2020 and lastly, compare them to see what forestation changes occured in selected areas. The selected image below shows our results for Battagram district from 2014 to 2020, where red pixels are non-forest labels, green pixels are forest labels and the last image shows overall gain/loss map from 2014 to 2020.

![Red and Green Heatmap for Forest Cover Change in Battagram](final-battagram-change.png "Forest Cover Change in Battagram")


## Usage
First install necessary requirements using 

    pip install -r requirements.txt
    cd code

## Data Collection
First you need to create the necessary pickle files used for either training or inference. These can be generated using data from Landsat8. We used images from 2014, 2016-2020 for training and 2015 for inference. If you want to use your own files, then you can use Google Earth Engine.

Once you obtain the necessary `.tiff` files, you can use`get_images_from_large_file` from `dataset.py` to generate the pickle dataset.

Having done so, generate the training lists for training, validation, and testing using `get_dataloaders_generated_data`. 

## Training
Training is done using U-Net Topology with VGG backbone. To train the model, a sample python command is present in `train_bash.txt`. For example, 

    python train.py --data /home/tukl/Projects/QasimWork/data/train/Pickled_data --data_split_lists /home/tukl/Projects/QasimWork/data/train/training_lists --models_dir /home/tukl/Projects/QasimWork/data/train/save_dir --summary_dir /home/tukl/Projects/QasimWork/data/train/summary --classes Non-Forest Forest --cuda 1 --bands 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 --topology ENC_4_DEC_4
    
    --data : the path to pickle files
    --data_split_lists: the folder to the lists generated by running get_loaders_generated_data
    --models_dir: where to store model checkpoints
    --summary_dir: where to store misc files generated during training
    --classes: which classes you want to train the model for
    --cuda: 1 or 0 depending on whether you have (or don't have) CUDA GPU available
    --bands: the bands which are present in your pickled data
    --topology: the model topology for U-NET. Possible values are ENC_1_DEC_1, ENC_2_DEC_2, ENC_3_DEC_3, ENC_4_DEC_4 

## Inference
`inference_btt_2020.py` is the script used to run inference on a given test image using the trained model.
 
 ## Reference
 Zulfiqar, A., Ghaffar, M. M., Shahzad, M., Weis, C., Malik, M. I., Shafait, F., & Wehn, N. (2021). AI-ForestWatch: semantic segmentation based end-to-end framework for forest estimation and change detection using multi-spectral remote sensing imagery. Journal of Applied Remote Sensing, 15(2), 024518.
